<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crafting</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.js"></script>
</head>
<body>
  <div class="containerMain">
    <div class="containerInfo"> 
      <div class="leftElipse"></div>
      <div class="topElipse"></div>
      <div class="bottomElipse"></div>
      <div class="header">
        <div class="square">
          <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none">
            <rect width="5" height="5" fill="white" fill-opacity="0.14"/>
            <rect x="12" width="5" height="5" fill="white" fill-opacity="0.14"/>
            <rect x="24" width="5" height="5" fill="white" fill-opacity="0.14"/>
            <rect y="12" width="5" height="5" fill="white" fill-opacity="0.14"/>
            <rect x="12" y="12" width="5" height="5" fill="white" fill-opacity="0.14"/>
            <rect x="24" y="12" width="5" height="5" fill="white" fill-opacity="0.14"/>
            <rect y="24" width="5" height="5" fill="white" fill-opacity="0.14"/>
            <rect x="12" y="24" width="5" height="5" fill="white" fill-opacity="0.14"/>
            <rect x="24" y="24" width="5" height="5" fill="white" fill-opacity="0.14"/>
            </svg>
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" width="243" height="121" viewBox="0 0 243 121" fill="none">
          <rect x="121.45" y="-169" width="170.867" height="170.867" transform="rotate(45 121.45 -169)" fill="url(#paint0_linear_304_13)"/>
          <rect x="120.82" y="-119.935" width="169.867" height="169.867" transform="rotate(45 120.82 -119.935)" fill="#8D76FF" fill-opacity="0.07" stroke="url(#paint1_linear_304_13)"/>
          <defs>
          <linearGradient id="paint0_linear_304_13" x1="182.946" y1="-106.541" x2="291.94" y2="2.45348" gradientUnits="userSpaceOnUse">
          <stop stop-color="#8D76FF"/>
          <stop offset="1" stop-color="#8D76FF" stop-opacity="0"/>
          </linearGradient>
          <linearGradient id="paint1_linear_304_13" x1="303.599" y1="63.1002" x2="215.442" y2="-14.3714" gradientUnits="userSpaceOnUse">
          <stop stop-color="#8D76FF"/>
          <stop offset="1" stop-color="#8D76FF" stop-opacity="0"/>
          </linearGradient>
          </defs>
          </svg>
          <img src="./image/img/upset.png">
          <span class="logoText">CRAFTING</span>
          <span class="textSystemBack">System</span>
          <span class="textSystem">System</span>
      </div> 
      <div class="containerSecond">
        <div class="infoBlock">
          <div class="infoGun">
            <div class="title">
              <div class="rectangle"></div>
              <span class="nameGun">M4A9- NIKE EDITION</span>
            </div>
            <span class="aboutGun">Morem ipsum dolor sit amet, consectetur adipiscing elit. Etiam eu turpis molestie, dictum est a, mattis tellus. Sed dignissim, metus nec fringilla accumsan, risus sem sollicitudin lacus, ut interdum tellus elit</span>
          </div>
          <div class="resurces">
            <div class="title">
              <div class="rectangle"></div>
              <span class="nameGun">NEEDS FOR CRAFTING</span>
            </div>
            <div class="items">
              <div class="item">
                <div class="count11">x2</div>
                <img src="" class="img11">
                <span class="itemName11">Item name</span>
              </div>
              <div class="item">
                <div class="count12">x2</div>
                <img src="" class="img12">
                <span class="itemName12">Item name</span>
              </div>
              <div class="item">
                <div class="count13">x2</div>
                <img src="" class="img13">
                <span class="itemName13">Item name</span>
              </div>
            </div>
            <div class="itemsSecond">
              <div class="item">
                <div class="count21">x2</div>
                <img src="" class="img21">
                <span class="itemName21">Item name</span>
              </div>
              <div class="item">
                <div class="count22">x2</div>
                <img src="" class="img22">
                <span class="itemName22">Item name</span>
              </div>
              <div class="item">
                <div class="count23">x2</div>
                <img src="" class="img23">
                <span class="itemName23">Item name</span>
              </div>
            </div>
          </div>
        </div>
        <div class="craftBlock">
            <div class="imgGun">
              <img src="" class="imgIcon">
              <svg xmlns="http://www.w3.org/2000/svg" width="582" height="590" viewBox="0 0 582 590" fill="none">
                <rect x="314.451" y="80.7071" width="219.222" height="219.222" transform="rotate(45 314.451 80.7071)" fill="url(#paint0_linear_320_218)" fill-opacity="0.15" stroke="url(#paint1_linear_320_218)"/>
                <g filter="url(#filter0_d_320_218)">
                <rect x="314.451" y="116.559" width="220.222" height="220.222" transform="rotate(45 314.451 116.559)" fill="url(#paint2_radial_320_218)" fill-opacity="0.07"/>
                <rect x="314.451" y="117.266" width="219.222" height="219.222" transform="rotate(45 314.451 117.266)" stroke="url(#paint3_linear_320_218)"/>
                </g>
                <defs>
                <filter id="filter0_d_320_218" x="0.730225" y="-37.4407" width="627.441" height="627.441" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                <feFlood flood-opacity="0" result="BackgroundImageFix"/>
                <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
                <feOffset dy="4"/>
                <feGaussianBlur stdDeviation="79"/>
                <feColorMatrix type="matrix" values="0 0 0 0 0.552941 0 0 0 0 0.462745 0 0 0 0 1 0 0 0 0.25 0"/>
                <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_320_218"/>
                <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_320_218" result="shape"/>
                </filter>
                <linearGradient id="paint0_linear_320_218" x1="424.319" y1="189.868" x2="534.726" y2="300.275" gradientUnits="userSpaceOnUse">
                <stop stop-color="#8D76FF" stop-opacity="0"/>
                <stop offset="1" stop-color="#8D76FF"/>
                </linearGradient>
                <linearGradient id="paint1_linear_320_218" x1="538.522" y1="304.557" x2="455.582" y2="221.617" gradientUnits="userSpaceOnUse">
                <stop stop-color="#8D76FF"/>
                <stop offset="1" stop-color="#8D76FF" stop-opacity="0"/>
                </linearGradient>
                <radialGradient id="paint2_radial_320_218" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(424.562 226.67) rotate(15.7879) scale(168.642)">
                <stop stop-color="#8D76FF"/>
                <stop offset="1" stop-color="#8D76FF" stop-opacity="0"/>
                </radialGradient>
                <linearGradient id="paint3_linear_320_218" x1="538.522" y1="341.116" x2="424.076" y2="226.67" gradientUnits="userSpaceOnUse">
                <stop stop-color="#8D76FF"/>
                <stop offset="1" stop-color="#8D76FF" stop-opacity="0"/>
                </linearGradient>
                </defs>
                </svg>
            </div>
            <div class="imgGunInfo">
              <button class="buttonCraft">Craft</button>
              <div class="underButton"></div>
              <div class="timeBlock">
                <div class="time">
                  <span class="timeText">Crafting time</span>
                </div>
                <div class="timeCount">
                  <span class="timing"></span>
                </div>
              </div>
            </div>
      </div>
    </div>
    <div class="containerThird">
      <div class="chooseGun">
        <div class="title">
          <div class="rectangle"></div>
          <span class="nameGun">What can i craft?</span>
        </div>
        <div class="list" id="itemList">
          <button class="back" onclick="scrollList(-1)"><svg xmlns="http://www.w3.org/2000/svg" width="6" height="11" viewBox="0 0 6 11" fill="none">
            <path d="M0 5.5L5.5 0V11L0 5.5Z" fill="#8D76FF"/>
          </svg></button>
          <div class="itemListContainer" id="itemListContainer"></div>
          <button class="forward" onclick="scrollList(1)"><svg xmlns="http://www.w3.org/2000/svg" width="6" height="11" viewBox="0 0 6 11" fill="none">
            <path d="M6 5.5L0.5 0V11L6 5.5Z" fill="#8D76FF"/>
          </svg></button>
        </div>
      </div>
    </div>
    <div class="squareSecond">
      <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none">
        <rect width="5" height="5" fill="white" fill-opacity="0.14"/>
        <rect x="12" width="5" height="5" fill="white" fill-opacity="0.14"/>
        <rect x="24" width="5" height="5" fill="white" fill-opacity="0.14"/>
        <rect y="12" width="5" height="5" fill="white" fill-opacity="0.14"/>
        <rect x="12" y="12" width="5" height="5" fill="white" fill-opacity="0.14"/>
        <rect x="24" y="12" width="5" height="5" fill="white" fill-opacity="0.14"/>
        <rect y="24" width="5" height="5" fill="white" fill-opacity="0.14"/>
        <rect x="12" y="24" width="5" height="5" fill="white" fill-opacity="0.14"/>
        <rect x="24" y="24" width="5" height="5" fill="white" fill-opacity="0.14"/>
        </svg>
    </div>
  </div>
  <script>
    const components = {
      0: ['AK-47', 'AK-47 - NIKE EDITION', '9 Min', 'Morem ipsum dolor sit amet, consectetur adipiscing elit. Etiam eu turpis molestie, dictum est a, mattis tellus. Sed dignissim, metus nec fringilla accumsan, risus sem sollicitudin lacus, ut interdum tellus elit', 'Battery', 'x2', 'Duct tape', 'x1', 'Iron', 'x8', 'FlashHider', 'x1'],
      1: ['Navy Revolver', 'Navy Revolver', '5 Min', 'Morem ipsum dolor sit amet consectetur adipiscing elit.', 'Battery', 'x1', 'Screwdriver', 'x4'],
      2: ['SIG MPX-SD', 'Combat - PDW', '15 Min', 'Sed dignissim, metus nec fringilla accumsan, risus sem sollicitudin lacus', 'Battery', 'x6', 'Iron', 'x8', 'FlashHider', 'x1', 'Duct tape', 'x1', 'Magazine', 'x2'],
      3: ['Intratec TEC-9', 'Machine Pistol', '2 Min', 'Morem ipsum dolor sit amet, consectetur adipiscing elit. Etiam eu turpis molestie, dictum est a, mattis tellus. Sed dignissim, metus nec fringilla accumsan', 'Duct tape', 'x1', 'Iron', 'x8', 'FlashHider', 'x1', 'Battery', 'x1', 'Screwdriver', 'x3', 'Magazine', 'x3'],  
      4: ['Steyr SPP', 'Tactica lSMG', '35 Min', 'Morem ipsum dolor sit amet consectetur adipiscing elit.', 'Iron', 'x8', 'FlashHider', 'x1', 'Duct tape', 'x1'], 
      5: ['Scorpion vz.61', 'Mini - SMG', '17 Min', 'Morem ipsum dolor sit amet, consectetur adipiscing elit. Etiam eu turpis molestie, dictum est a, mattis tellus. Sed dignissim, metus nec fringilla accumsan, risus sem sollicitudin lacus, ut interdum tellus elit', 'Battery', 'x2', 'Duct tape', 'x1', 'Iron', 'x8', 'FlashHider', 'x1'], 
      6: ['Mk 48 & M60', 'Combatmg', '6 Min', 'Sed dignissim, metus nec fringilla accumsan, risus sem sollicitudin lacus', 'Battery', 'x1', 'Screwdriver', 'x4'],
      7: ['M16', 'Service - Carbine', '0.3 Min', 'Morem ipsum dolor sit amet consectetur adipiscing elit.', 'Iron', 'x8', 'FlashHider', 'x1', 'Duct tape', 'x1', 'Magazine', 'x2'],
};


const activeTimers = {};

function runTimer(itemKey, startTime, totalTime) {
  const timerInterval = setInterval(() => {
    const currentTime = Date.now();
    const elapsed = Math.floor((currentTime - startTime) / 1000);
    const remainingTime = totalTime - elapsed;

    if (remainingTime > 0) {
      activeTimers[itemKey] = remainingTime;
      if (localStorage.getItem('activeItemKey') === itemKey) {
        updateTimingDisplay(remainingTime);
      }
    } else {
      clearInterval(timerInterval);
      activeTimers[itemKey] = 0; 
      localStorage.removeItem(`timer_${itemKey}`);
      if (localStorage.getItem('activeItemKey') === itemKey) {
        document.querySelector('.timing').textContent = 'Complete';
      }
    }
  }, 1000);
}

function timeToSeconds(timeStr) {
  const timeParts = timeStr.split(' ');
  const minutes = parseFloat(timeParts[0]); 
  return Math.floor(minutes * 60); 
}

function startTimer(itemKey) {
  const item = components[itemKey];
  const totalTime = timeToSeconds(item[2]); 
  const startTime = Date.now();
  localStorage.setItem(`timer_${itemKey}`, JSON.stringify({ startTime, totalTime }));

  runTimer(itemKey, startTime, totalTime);
}

function restoreTimers() {
  Object.keys(components).forEach(itemKey => {
    const savedTimer = localStorage.getItem(`timer_${itemKey}`);
    if (savedTimer) {
      const { startTime, totalTime } = JSON.parse(savedTimer);
      runTimer(itemKey, startTime, totalTime);
    }
  });
}

document.addEventListener('DOMContentLoaded', restoreTimers);
document.querySelector('.buttonCraft').addEventListener('click', function() {
  const currentItemKey = localStorage.getItem('activeItemKey');
  if (!activeTimers[currentItemKey] || activeTimers[currentItemKey] <= 0) {
    startTimer(currentItemKey);
  }
});

function updateTimingDisplay(timeInSeconds) {
  const minutes = Math.floor(timeInSeconds / 60);
  const seconds = timeInSeconds % 60;
  document.querySelector('.timing').textContent = `${minutes} MIN ${seconds.toString().padStart(2, '0')} SEC`;
}

document.querySelector('.buttonCraft').addEventListener('click', function() {
  const currentItemKey = localStorage.getItem('activeItemKey');
  if (!activeTimers[currentItemKey]) {
    startTimer(currentItemKey);
  }
});

function closeContainer() {
  var container = document.querySelector('.containerMain'); 
  if (container) {
    container.style.display = 'none'; 
  }
};

document.addEventListener('keydown', function(event){
  console.log("Button was clicked", event.key)
  if (event.key === "Escape") {
    closeContainer();
  } 
});

document.querySelectorAll('.itemGun').forEach(item => {
  item.addEventListener('click', function() {
    const itemKey = this.getAttribute('data-key');
    if (activeTimers[itemKey]) {
      updateTimingDisplay(activeTimers[itemKey]);
    }
  });
});

document.addEventListener('DOMContentLoaded', function () {
  localStorage.setItem('activeItemKey', '0');
  showList();
  selectFirstItem();
});

  document.addEventListener('DOMContentLoaded', function () {
    localStorage.setItem('activeItemKey', '0');
    showList();
    selectFirstItem();
  });

document.addEventListener('DOMContentLoaded', function () {
  localStorage.setItem('activeItemKey', '0');
  showList();
  selectFirstItem();
});

document.addEventListener('DOMContentLoaded', function() {
      fetchComponents();
    });

    let currentIndex = 0;
    const infoGun = document.getElementById('infoGun');
    const backBtn = document.querySelector('.back');
    const forwardBtn = document.querySelector('.forward');
  
    function showList() {
      itemListContainer.innerHTML = '';

      const itemsToDisplay = Object.keys(components).slice(currentIndex, currentIndex + 4);
        for (let key of itemsToDisplay) {
        const itemGun = document.createElement('div');
        itemGun.className = 'itemGun';
        itemGun.setAttribute('data-key', key); 

        itemGun.addEventListener('click', function() {
        document.querySelectorAll('.itemGun').forEach(function(el) {
        el.classList.remove('active');
        });

  itemGun.classList.add('active');

  localStorage.setItem('activeItemKey', key);

  updateInfoGun(components[key]);
});

    const timeGun = document.createElement('div');
    timeGun.className = 'timeGun';
    const timeGunText = document.createElement('span');
    timeGunText.className = 'timeGunText';
    timeGunText.textContent = components[key][2];
    timeGun.appendChild(timeGunText);

    const img = document.createElement('img');
    img.src = `./image/img/${components[key][1]}.png`;

    const itemGunName = document.createElement('span');
    itemGunName.className = 'itemGunName';
    itemGunName.textContent = components[key][0];

    itemGun.appendChild(timeGun);
    itemGun.appendChild(img);
    itemGun.appendChild(itemGunName);

    itemListContainer.appendChild(itemGun);
  }

  const activeItemKey = localStorage.getItem('activeItemKey');

  if (activeItemKey !== null) {
    const activeItem = itemListContainer.querySelector(`.itemGun[data-key="${activeItemKey}"]`);

    if (activeItem) {
      activeItem.classList.add('active');
    }
  }
}

function selectFirstItem() {
  const firstItem = itemListContainer.querySelector('.itemGun[data-key="0"]');
  if (firstItem) {
    document.querySelectorAll('.itemGun').forEach(function(el) {
      el.classList.remove('active');
    });

    firstItem.classList.add('selected');
    firstItem.classList.add('active');
    updateInfoGun(components[0]);

    localStorage.setItem('activeItemKey', '0');
  }
}

document.addEventListener('DOMContentLoaded', function() {
  localStorage.setItem('activeItemKey', '0');
  showList();
});
  
    function scrollList(direction) {
      currentIndex += direction * 4;
  
      if (currentIndex < 0) {
        currentIndex = 0;
      } else if (currentIndex >= Object.keys(components).length) {
        currentIndex = 0;
      }
  
      updateButtonsState();
      showList();
    }
  
    function updateButtonsState() {
      backBtn.disabled = currentIndex <= 0;
  
      forwardBtn.disabled = currentIndex >= Object.keys(components).length - 4;
    }

    function updateInfoGun(component) {
      const [name, edition, time, about, item1, count1, item2, count2, item3, count3, item4, count4, item5, count5, item6, count6] = component;
      const nameGun = document.querySelector('.infoGun .nameGun');
      const imgGun = document.querySelector('.imgGun .imgIcon');
      const timing = document.querySelector ('.timeCount .timing');
      const aboutGun = document.querySelector('.infoGun .aboutGun');
      const itemName11 = document.querySelector('.item .itemName11');
      const itemImg11 = document.querySelector('.item .img11');
      const count11 = document.querySelector('.item .count11');
      const itemName12 = document.querySelector('.item .itemName12');
      const itemImg12 = document.querySelector('.item .img12');
      const count12 = document.querySelector('.item .count12');
      const itemName13 = document.querySelector('.item .itemName13');
      const itemImg13 = document.querySelector('.item .img13');
      const count13 = document.querySelector('.item .count13');
      const itemName21 = document.querySelector('.itemsSecond .itemName21');
      const itemImg21 = document.querySelector('.item .img21');
      const count21 = document.querySelector('.itemsSecond .count21');
      const itemName22 = document.querySelector('.itemsSecond .itemName22');
      const itemImg22 = document.querySelector('.item .img22');
      const count22 = document.querySelector('.itemsSecond .count22');
      const itemName23 = document.querySelector('.itemsSecond .itemName23');
      const itemImg23 = document.querySelector('.item .img23');
      const count23 = document.querySelector('.itemsSecond .count23');
      nameGun.textContent =  edition;
      imgGun.src = `./image/img/${edition}.png`;
      timing.textContent = time;
      aboutGun.textContent = about;
      itemName11.textContent = item1;
      if (item1){
        itemImg11.src = `./image/img/itemCraft/${item1}.png`;
      }
      else{
        itemImg11.src = '';
      }
      count11.textContent = count1;
      itemName12.textContent = item2;
      if (item2){
        itemImg12.src = `./image/img/itemCraft/${item2}.png`;
      }
      else{
        itemImg12.src = '';
      }
      count12.textContent = count2;
      itemName13.textContent = item3;
      if (item3){
        itemImg13.src = `./image/img/itemCraft/${item3}.png`;
      }
      else{
        itemImg13.src = '';
      }
      count13.textContent = count3;
      itemName21.textContent = item4;
      if (item4){
        itemImg21.src = `./image/img/itemCraft/${item4}.png`;
      }
      else{
        itemImg21.src = '';
      }
      count21.textContent = count4;
      itemName22.textContent = item5;
      if (item5){
        itemImg22.src = `./image/img/itemCraft/${item5}.png`;
      }
      else{
        itemImg22.src = '';
      }
      count22.textContent = count5;
      itemName23.textContent = item6;
      if (item6){
        itemImg23.src = `./image/img/itemCraft/${item6}.png`;
      }
      else{
        itemImg23.src = '';
      }
      count23.textContent = count6;
    }

    function fetchComponents() {
      fetch('/api/components')
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          components = data;
        })
        .catch(error => {
          console.error('There was a problem with your fetch operation:', error);
        });
    }

    updateButtonsState();
    showList();
    document.addEventListener('DOMContentLoaded', selectFirstItem);
    

  </script>
</body>
</html>



